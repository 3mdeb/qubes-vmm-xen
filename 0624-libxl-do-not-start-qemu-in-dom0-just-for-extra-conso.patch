From 39b219794cb55df609fa5bf4afc9523a16e919b6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>
Date: Wed, 16 Nov 2022 01:28:47 +0100
Subject: [PATCH 24/26] libxl: do not start qemu in dom0 just for extra
 consoles
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

We prefer to have broken extra consoles (breaking also saving/restoring HVM to
a savefile), than running qemu in dom0.

Signed-off-by: Marek Marczykowski-GÃ³recki <marmarek@invisiblethingslab.com>
---
 tools/libs/light/libxl_dm.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/tools/libs/light/libxl_dm.c b/tools/libs/light/libxl_dm.c
index f0895f192cf8..09f0c2a83ead 100644
--- a/tools/libs/light/libxl_dm.c
+++ b/tools/libs/light/libxl_dm.c
@@ -2583,7 +2583,7 @@ static void spawn_stub_launch_dm(libxl__egc *egc,
      * Until xenconsoled learns how to handle multiple consoles, require qemu
      * in dom0 to serve consoles for a stubdomain - it require at least 3 of them.
      */
-    need_qemu = 1 || libxl__need_xenpv_qemu(gc, &sdss->dm_config);
+    need_qemu = libxl__need_xenpv_qemu(gc, &sdss->dm_config);
 
     for (i = 0; i < num_console; i++) {
         libxl__device device;
@@ -2720,7 +2720,7 @@ static void qmp_proxy_spawn_outcome(libxl__egc *egc,
      * Until xenconsoled learns how to handle multiple consoles, require qemu
      * in dom0 to serve consoles for a stubdomain - it require at least 3 of them.
      */
-    int need_pvqemu = 1 || libxl__need_xenpv_qemu(gc, &sdss->dm_config);
+    int need_pvqemu = libxl__need_xenpv_qemu(gc, &sdss->dm_config);
 
     if (rc) goto out;
 
-- 
2.37.3

